![image](https://github.com/user-attachments/assets/708ffdd4-6cc8-43c1-8f21-bf22570608d8)# [OSINT] 迅帝

## By: LK
## Challenge Description
![image](https://github.com/user-attachments/assets/474e463b-1947-4b7e-8900-2858f3bbd763)

## Write-Up
The goal of this challenge is to find the `Melancholy Angel` which is said to be holding the flag to this challenge.

A quick online search on the suspicious challenge name `迅帝` shows that it is related to `Shutokō Battle Rival` which is a Japanese car racing game.
> Shutokō Battle Rival is a racing game in the Shutokō Battle series, also known as the Tokyo Xtreme Racer series outside of Japan. The game is developed by Genki and is part of the popular Shutokō Battle franchise, which focuses on street racing on the highways of Tokyo.

![image](https://github.com/user-attachments/assets/232fc582-7206-461e-afc3-b7b82accf27f)

![image](https://github.com/user-attachments/assets/4ea363af-a8ca-42f1-9b98-b21debf0108c)
[Click to view Search Result Page](https://genkirivalproject.fandom.com/wiki/%E5%B2%A9%E5%B4%8E_%E5%9F%BA%E7%9F%A2)

Another search reveals that the `Melancholy Angel` is actually a character inside the game, specifically in `ITC` which stands for `Import Tuner Challenge` (as shown in the figures below).
>Melancholy Angel (also known as Gloomy Angel in Tokyo Xtreme Racer: Drift 2, Dejected Angel in Tokyo Xtreme Racer 3, and Unhappy Angel in Tokyo Xtreme Racer: Zero Gloomy Angel) is a recurring boss in the Tokyo Xtreme Racer series. She drives a custom Mazda RX-8, called Melancholy Angel (SE3PCuMA), with angel wings mounted above the rear window, heart-shaped exhaust tips, and a pink driver's seat.

![image](https://github.com/user-attachments/assets/c11456ef-6153-4546-91af-7fae36ef466e)

![image](https://github.com/user-attachments/assets/ae4712b4-c5cf-4f99-b0a8-e2f67ee20a33)

![image](https://github.com/user-attachments/assets/8eb9c03f-52df-4d25-b07e-50b98c84383c)

![image](https://github.com/user-attachments/assets/c30bbbba-a303-4022-8d26-e908bd85db2f)

![image](https://github.com/user-attachments/assets/ba9e77b2-135f-4a4c-91ce-82fbf51c030d)

Also, based on the challenge description, the duration of waiting which is `18 years` indicates that the item that we are finding was published in `2006`.

Exploring the [Shutokō Battle Rival Database](https://genkirivalproject.fandom.com/) (home/index page of the above wiki page), we can see that the `Import Tuner Challenge` game was released in `2006` as well, which confirms that `ITC` is the key of this challenge.

Plus, the hint (YouTube video link) confirms that ITC 2006 is definitely involved.

![image](https://github.com/user-attachments/assets/28765142-6467-48ac-b9df-9e95f7185ff8)

Now, to read the TOC and DAT files given in the challenge.
> In the context of games, .DAT and .TOC are commonly used in games to store:
>+ .DAT: Game data (binary or encoded).
>+ .TOC: Table of Contents (pointers to data within the .DAT file).
>  
>(Thanks ChatGPT)


A quick search online using the keywords `Import Tuner DAT file` reveals a topic discussion on `Import Tuner Challenge (XBOX360)`, specifically using the `tokyo_xtreme_racer.bms` script to dump the game's .DAT/.TOC files.
![image](https://github.com/user-attachments/assets/8ec27f5a-9122-468f-974a-16fe480bb7b1)

Now, to find and run this script. 

![image](https://github.com/user-attachments/assets/88c5f80a-c1c2-42d2-ae19-910b8658b1f3)

A lookup on `bms script` reveals that BMS scripts are often used to extract and unpack game files and the scripts can be run with [QuickBMS](https://aluigi.altervista.org/quickbms.htm). 
>QuickBMS is a versatile tool created by Luigi Auriemma for handling file extraction, decryption, and data manipulation tasks. It is used primarily for unpacking proprietary file formats in games and software. QuickBMS requires scripts written in the BMS scripting language to know how to handle specific file formats.

![image](https://github.com/user-attachments/assets/1494e2c6-27c0-46d4-8538-b1ecc92b0b2c)

To download `QuickBMS`, just click on the first link [`QuickBMS generic files extractor and reimporter 0.12`](https://aluigi.altervista.org/papers/quickbms.zip) on the QuickBMS page.

It will download a zip file named `quickbms.zip`. Unzip it for later use.
![image](https://github.com/user-attachments/assets/2dcc855d-80d9-409f-8cb6-b3ca30ee5db5)


Searching `tokyo_xtreme_racer.bms where` reveals the location to download the said script, which can be found on the [QuickBMS site](https://aluigi.altervista.org/bms/tokyo_xtreme_racer.bms). Download it by clicking on the link.

![image](https://github.com/user-attachments/assets/a361f6f0-db84-4ad4-a6a7-051f3f094551)

> If you are clicking the link to the script directly from the search results above, your browser might warn that the script cannot be downloaded securely. <br>![image](https://github.com/user-attachments/assets/04366dbd-d6c0-4eab-a820-ec6a33ae6db1)<br>This is because the download location was loaded over an insecure HTTP connection. You can just choose to keep the file but if you want to be safe, you can search for the file in the QuickBMS webpage. Just search for `Tokyo Xtreme Racer` and you will find the said script. <br> ![image](https://github.com/user-attachments/assets/7a8b5f85-36d1-4af9-b0f1-5d94bcdf67f6)
 <br>This method will allow for the download to happen over a HTTPS connection.

With the files, tool and script ready, we can start to extract and dump the game files. 
>Recall that we were given DAT and TOC files for this challenge.

For easier file management, it is recommended to put all the relevant files in the QuickBMS tool folder as follows.
![image](https://github.com/user-attachments/assets/b65b31cd-1778-44a6-80c2-3d28784671e5)

As the GUI version of the tool did not work for me, I used the command line version of QuickBMS for this challenge.
![image](https://github.com/user-attachments/assets/06fe78be-237f-4e45-bb7f-a440e679b2d8)
Open a terminal in the directory where the file is located and type the following command:
```./quickbms.exe tokyo_xtreme_racer.bms BUILD.TOC extracted_files/```
>+ tokyo_xtreme_racer.bms: The QuickBMS script file to run.
>+ BUILD.TOC: The TOC file that maps and references data stored in the associated BUILD.DAT file that you want to extract. <b>Optional: You can directly use BUILD.DAT instead of BUILD.TOC here.</b> It gives the same results.
>+ extracted_files/: Directory where extracted files will be saved.

![image](https://github.com/user-attachments/assets/2fa72284-736b-4dbd-837e-63d04174bd32)

Upon running the said command, the tool will prompt to create a new folder if the folder mentioned in the command has not been created. Enter 'y' to continue if the folder is not created.

![image](https://github.com/user-attachments/assets/f26caff9-2d97-4b82-b1c2-9bd7c25db1f7)

After that, the script will continue running, dumping the extracted files from the BUILD.DAT file into the `extracted_files/` directory.
![image](https://github.com/user-attachments/assets/05b3f6f8-ed73-4116-98c4-40439db9e6e6)

![image](https://github.com/user-attachments/assets/688fcc8d-e80c-4a4d-a8de-68b6267fecb8)

This is what the terminal looks like after the script finishes its execution.
![image](https://github.com/user-attachments/assets/04649a50-8ab3-413a-9e30-a644190d0b8e)

There will be <b>22995</b> files with the size of a whopping 2.39GB.
![image](https://github.com/user-attachments/assets/8df24669-5ccb-4161-b2c9-14dce527d3b9)

To go through the files quickly, I used Autopsy. This is a strange but very effective move as it allows me to go through the files fast.

![image](https://github.com/user-attachments/assets/1021e87e-e1bd-4ed1-b22a-3c060cf98aee)

At the 188th TGA file, we found the `Melancholy Angel` which indeed has the flag written all over her.

#### Flag: `wgmy{bf125e1fd5095254a4bd93ffc300e256}`



